(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function (global){
"use strict";

var Renderer = require("./Renderer").Renderer;

global.app = function () {
  var renderer = new Renderer();
};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9maWxsZS9HaXRodWIvVE5NMDg0X2xhYjMvc3JjL2FwcC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7SUFBUyxRQUFRLFdBQVEsWUFBWSxFQUE1QixRQUFROztBQUVqQixNQUFNLENBQUMsR0FBRyxHQUFHLFlBQVk7QUFDdkIsTUFBSSxRQUFRLEdBQUcsSUFBSSxRQUFRLEVBQUUsQ0FBQztDQUMvQixDQUFDIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSZW5kZXJlciB9IGZyb20gJy4vUmVuZGVyZXInO1xuXG5nbG9iYWwuYXBwID0gZnVuY3Rpb24gKCkge1xuICBsZXQgcmVuZGVyZXIgPSBuZXcgUmVuZGVyZXIoKTtcbn07XG4iXX0=
},{"./Renderer":2}],2:[function(require,module,exports){
"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var key in props) { var prop = props[key]; prop.configurable = true; if (prop.value) prop.writable = true; } Object.defineProperties(target, props); } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _classCallCheck = function (instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } };

Object.defineProperty(exports, "__esModule", {
  value: true
});

var LoadShaders = require("./ShaderLoader").LoadShaders;

var gl = null;

var Renderer = exports.Renderer = (function () {
  function Renderer() {
    var _this = this;

    _classCallCheck(this, Renderer);

    this.canvas = null;
    this.buffer;
    this.vertex_shader;
    this.fragment_shader;
    //this.tracerProgram;
    this.renderProgram;
    this.vertex_position;
    this.timeLocation;
    this.resolutionLocation;
    this.mousePositionLocation;
    this.parameters = { start_time: new Date().getTime(), time: 0, screenWidth: 0, screenHeight: 0, samples: 0 };

    this.samplesLocation;
    this.renderSamplesLocation;

    this.vertexBuffer = null;
    this.frameBuffer = null;
    this.fb = null;
    this.textures = [];
    this.tracerProgram = null;
    this.renderVertexAttribute = null;

    this.triangleTexture = null;

    this.mousePosition = { x: 0, y: 0 };

    this.init();

    this.animate = function (time) {
      _this.resizeCanvas();
      gl.viewport(0, 0, _this.canvas.width, _this.canvas.height);

      // render to texture
      gl.useProgram(_this.tracerProgram);

      var location1 = gl.getUniformLocation(_this.tracerProgram, "u_buffer_texture");
      var location2 = gl.getUniformLocation(_this.tracerProgram, "u_triangle_texture");

      gl.uniform1i(location1, 0);
      gl.uniform1i(location2, 1);

      gl.activeTexture(gl.TEXTURE0);
      gl.bindTexture(gl.TEXTURE_2D, _this.textures[0]);
      gl.activeTexture(gl.TEXTURE1);
      gl.bindTexture(gl.TEXTURE_2D, _this.triangleTexture);

      gl.bindBuffer(gl.ARRAY_BUFFER, _this.vertexBuffer);
      gl.bindFramebuffer(gl.FRAMEBUFFER, _this.fb);
      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, _this.textures[1], 0);
      gl.vertexAttribPointer(_this.tracerVertexAttribute, 2, gl.FLOAT, false, 0, 0);
      gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
      gl.bindFramebuffer(gl.FRAMEBUFFER, null);

      _this.parameters.time = new Date().getTime() - _this.parameters.start_time;
      _this.parameters.samples += 1;

      gl.uniform1f(_this.timeLocation, _this.parameters.time / 1000);
      gl.uniform1f(_this.samplesLocation, _this.parameters.samples);
      gl.uniform2f(_this.resolutionLocation, _this.parameters.screenWidth, _this.parameters.screenHeight);
      gl.uniform2f(_this.mousePositionLocation, _this.mousePosition.x, _this.mousePosition.y);

      _this.textures.reverse();

      gl.useProgram(_this.renderProgram);
      gl.bindTexture(gl.TEXTURE_2D, _this.textures[0]);
      gl.bindBuffer(gl.ARRAY_BUFFER, _this.vertexBuffer);
      gl.vertexAttribPointer(_this.renderVertexAttribute, 2, gl.FLOAT, false, 0, 0);
      gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
      gl.uniform1f(_this.renderSamplesLocation, _this.parameters.samples);

      requestAnimationFrame(_this.animate);
    };
  }

  _createClass(Renderer, {
    createRenderProgram: {
      value: function createRenderProgram() {
        var vertices = [-1, -1, -1, 1, 1, -1, 1, 1];
        this.vertexBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexBuffer);
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);

        //this.frameBuffer = gl.createFramebuffer();
        this.fb = gl.createFramebuffer();

        var type = gl.getExtension("OES_texture_float") ? gl.FLOAT : gl.UNSIGNED_BYTE;
        this.textures = [];
        for (var i = 0; i < 2; i++) {
          this.textures.push(gl.createTexture());
          gl.bindTexture(gl.TEXTURE_2D, this.textures[i]);
          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
          gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, 512, 512, 0, gl.RGB, type, null);
        }
        gl.bindTexture(gl.TEXTURE_2D, null);

        // create render shader
        var render_vertex_shader = document.getElementById("vs_render").textContent;
        var render_fragment_shader = document.getElementById("fs_render").textContent;
        this.renderProgram = this.createProgram(render_vertex_shader, render_fragment_shader);
        this.renderVertexAttribute = gl.getAttribLocation(this.renderProgram, "vertex");
        gl.enableVertexAttribArray(this.renderVertexAttribute);
      }
    },
    allocateTexture: {
      value: function allocateTexture() {
        this.triangleTexture = gl.createTexture();
        gl.bindTexture(gl.TEXTURE_2D, this.triangleTexture);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
      }
    },
    addSceneTextures: {
      value: function addSceneTextures(triangleArray) {
        this.allocateTexture();
        var width = 1024;
        var height = 1024;
        var format = gl.RGB;

        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, width, height, 0, format, gl.FLOAT, triangleArray);
      }
    },
    init: {
      value: function init() {
        var _this = this;

        console.log("init renderer");
        LoadShaders(["./dist/kernels/header.glsl", "./dist/kernels/cellular3D.glsl", "./dist/kernels/noise3D.glsl", "./dist/kernels/main.glsl"], function (kernelData) {
          _this.fragment_shader = kernelData;
          _this.vertex_shader = document.getElementById("vs").textContent;
          _this.canvas = document.querySelector("canvas");

          // Initialise WebGL
          try {
            gl = _this.canvas.getContext("experimental-webgl");
          } catch (error) {}
          if (!gl) throw "cannot create webgl context";

          _this.createRenderProgram();

          // Create Vertex buffer (2 triangles)
          _this.buffer = gl.createBuffer();
          gl.bindBuffer(gl.ARRAY_BUFFER, _this.buffer);
          gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1, -1, -1, 1, 1, -1, 1, -1, 1, 1, -1, 1]), gl.STATIC_DRAW);

          // Create Program
          _this.tracerProgram = _this.createProgram(_this.vertex_shader, _this.fragment_shader);
          _this.tracerVertexAttribute = gl.getAttribLocation(_this.tracerProgram, "vertex");
          gl.enableVertexAttribArray(_this.tracerVertexAttribute);

          _this.timeLocation = gl.getUniformLocation(_this.tracerProgram, "time");
          _this.samplesLocation = gl.getUniformLocation(_this.tracerProgram, "samples");
          _this.resolutionLocation = gl.getUniformLocation(_this.tracerProgram, "resolution");
          _this.mousePositionLocation = gl.getUniformLocation(_this.tracerProgram, "mousePosition");
          _this.renderSamplesLocation = gl.getUniformLocation(_this.renderProgram, "samples");

          _this.animate();
        }, function () {});

        $("#render-canvas").mousemove(function (event) {
          _this.mousePosition.x = event.pageX;
          _this.mousePosition.y = event.pageY;
        });
      }
    },
    createProgram: {
      value: function createProgram(vertex, fragment) {
        var program = gl.createProgram();

        var vs = this.createShader(vertex, gl.VERTEX_SHADER);
        var fs = this.createShader(fragment, gl.FRAGMENT_SHADER);

        gl.attachShader(program, vs);
        gl.attachShader(program, fs);

        gl.deleteShader(vs);
        gl.deleteShader(fs);

        gl.linkProgram(program);

        var log = gl.getProgramInfoLog(program);
        if (log) {
          console.log(log);
        }

        log = gl.getShaderInfoLog(vs);
        if (log) {
          console.log(log);
        }

        log = gl.getShaderInfoLog(fs);
        if (log) {
          console.log(log);
        }

        if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
          return null;
        }

        return program;
      }
    },
    createShader: {
      value: function createShader(src, type) {
        var shader = gl.createShader(type);

        gl.shaderSource(shader, src);
        gl.compileShader(shader);

        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
          return null;
        }
        return shader;
      }
    },
    resizeCanvas: {
      value: function resizeCanvas(event) {
        if (this.canvas.width != this.canvas.clientWidth || this.canvas.height != this.canvas.clientHeight) {
          this.canvas.width = this.canvas.clientWidth;
          this.canvas.height = this.canvas.clientHeight;

          this.parameters.screenWidth = this.canvas.width;
          this.parameters.screenHeight = this.canvas.height;

          gl.viewport(0, 0, this.canvas.width, this.canvas.height);
        }
      }
    }
  });

  return Renderer;
})();

},{"./ShaderLoader":3}],3:[function(require,module,exports){
"use strict";

exports.LoadShaders = LoadShaders;
Object.defineProperty(exports, "__esModule", {
  value: true
});
function LoadShader(fileName, index, callback) {
  jQuery.get(fileName, function (data) {
    callback(data, index);
  });
}

function LoadShaders(fileNames, callback, errorCallback) {
  var loaded_files = 0;
  var shader_files = [];
  for (var file_index = 0; file_index < fileNames.length; file_index++) {
    LoadShader(fileNames[file_index], file_index, function (data, shader_index) {
      shader_files[shader_index] = data;

      loaded_files++;
      if (loaded_files == fileNames.length) {
        var total_shader_data = "";
        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = shader_files[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var shader_data = _step.value;

            total_shader_data += shader_data;
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator["return"]) {
              _iterator["return"]();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }

        callback(total_shader_data);
      }
    });
  }
}

},{}]},{},[1])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYXBwLmpzIiwiL1VzZXJzL2ZpbGxlL0dpdGh1Yi9UTk0wODRfbGFiMy9zcmMvUmVuZGVyZXIuanMiLCIvVXNlcnMvZmlsbGUvR2l0aHViL1ROTTA4NF9sYWIzL3NyYy9TaGFkZXJMb2FkZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7SUNWUyxXQUFXLFdBQVEsZ0JBQWdCLEVBQW5DLFdBQVc7O0FBRXBCLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQzs7SUFFRCxRQUFRLFdBQVIsUUFBUTtBQUNSLFdBREEsUUFBUSxHQUNMOzs7MEJBREgsUUFBUTs7QUFFakIsUUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7QUFDbkIsUUFBSSxDQUFDLE1BQU0sQ0FBQztBQUNaLFFBQUksQ0FBQyxhQUFhLENBQUM7QUFDbkIsUUFBSSxDQUFDLGVBQWUsQ0FBQzs7QUFFckIsUUFBSSxDQUFDLGFBQWEsQ0FBQztBQUNuQixRQUFJLENBQUMsZUFBZSxDQUFDO0FBQ3JCLFFBQUksQ0FBQyxZQUFZLENBQUM7QUFDbEIsUUFBSSxDQUFDLGtCQUFrQixDQUFDO0FBQ3hCLFFBQUksQ0FBQyxxQkFBcUIsQ0FBQztBQUMzQixRQUFJLENBQUMsVUFBVSxHQUFHLEVBQUUsVUFBVSxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxXQUFXLEVBQUcsQ0FBQyxFQUFFLFlBQVksRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxDQUFDOztBQUU5RyxRQUFJLENBQUMsZUFBZSxDQUFDO0FBQ3JCLFFBQUksQ0FBQyxxQkFBcUIsQ0FBQzs7QUFFM0IsUUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7QUFD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SUFBSSxDQUFDOztBQUVsQyxrQkFBWSxFQUFFLENBQUM7QUFDZixVQUFJLFlBQVksSUFBSSxTQUFTLENBQUMsTUFBTSxFQUFFO0FBQ3BDLFlBQUksaUJBQWlCLEdBQUcsRUFBRSxDQUFDOzs7Ozs7QUFDM0IsK0JBQXdCLFlBQVk7Z0JBQTNCLFdBQVc7O0FBQ2xCLDZCQUFpQixJQUFJLFdBQVcsQ0FBQztXQUNsQzs7Ozs7Ozs7Ozs7Ozs7OztBQUNELGdCQUFRLENBQUMsaUJBQWlCLENBQUMsQ0FBQztPQUM3QjtLQUNGLENBQUMsQ0FBQztHQUVOO0NBQ0YiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiKGZ1bmN0aW9uIChnbG9iYWwpe1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBSZW5kZXJlciA9IHJlcXVpcmUoXCIuL1JlbmRlcmVyXCIpLlJlbmRlcmVyO1xuXG5nbG9iYWwuYXBwID0gZnVuY3Rpb24gKCkge1xuICB2YXIgcmVuZGVyZXIgPSBuZXcgUmVuZGVyZXIoKTtcbn07XG5cbn0pLmNhbGwodGhpcyx0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvdyA6IHt9KVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZGF0YTphcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ6dXRmLTg7YmFzZTY0LGV5SjJaWEp6YVc5dUlqb3pMQ0p6YjNWeVkyVnpJanBiSWk5VmMyVnljeTltYVd4c1pTOUhhWFJvZFdJdlZFNU5NRGcwWDJ4aFlqTXZjM0pqTDJGd2NDNXFjeUpkTENKdVlXMWxjeUk2VzEwc0ltMWhjSEJwYm1keklqb2lPenM3U1VGQlV5eFJRVUZSTEZkQlFWRXNXVUZCV1N4RlFVRTFRaXhSUVVGUk96dEJRVVZxUWl4TlFVRk5MRU5CUVVNc1IwRkJSeXhIUVVGSExGbEJRVms3UVVGRGRrSXNUVUZCU1N4UlFVRlJMRWRCUVVjc1NVRkJTU3hSUVVGUkxFVkJRVVVzUTBGQlF6dERRVU12UWl4RFFVRkRJaXdpWm1sc1pTSTZJbWRsYm1WeVlYUmxaQzVxY3lJc0luTnZkWEpqWlZKdmIzUWlPaUlpTENKemIzVnlZMlZ6UTI5dWRHVnVkQ0k2V3lKcGJYQnZjblFnZXlCU1pXNWtaWEpsY2lCOUlHWnliMjBnSnk0dlVtVnVaR1Z5WlhJbk8xeHVYRzVuYkc5aVlXd3VZWEJ3SUQwZ1puVnVZM1JwYjI0Z0tDa2dlMXh1SUNCc1pYUWdjbVZ1WkdWeVpYSWdQU0J1WlhjZ1VtVnVaR1Z5WlhJb0tUdGNibjA3WEc0aVhYMD0iLCJpbXBvcnQgeyBMb2FkU2hhZGVycyB9IGZyb20gJy4vU2hhZGVyTG9hZGVyJztcblxudmFyIGdsID0gbnVsbDtcblxuZXhwb3J0IGNsYXNzIFJlbmRlcmVyIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5jYW52YXMgPSBudWxsO1xuICAgIHRoaXMuYnVmZmVyO1xuICAgIHRoaXMudmVydGV4X3NoYWRlcjtcbiAgICB0aGlzLmZyYWdtZW50X3NoYWRlcjtcbiAgICAvL3RoaXMudHJhY2VyUHJvZ3JhbTtcbiAgICB0aGlzLnJlbmRlclByb2dyYW07XG4gICAgdGhpcy52ZXJ0ZXhfcG9zaXRpb247XG4gICAgdGhpcy50aW1lTG9jYXRpb247XG4gICAgdGhpcy5yZXNvbHV0aW9uTG9jYXRpb247XG4gICAgdGhpcy5tb3VzZVBvc2l0aW9uTG9jYXRpb247XG4gICAgdGhpcy5wYXJhbWV0ZXJzID0geyBzdGFydF90aW1lOiBuZXcgRGF0ZSgpLmdldFRpbWUoKSwgdGltZTogMCwgc2NyZWVuV2lkdGggOiAwLCBzY3JlZW5IZWlnaHQ6IDAsIHNhbXBsZXM6IDAgfTtcblxuICAgIHRoaXMuc2FtcGxlc0xvY2F0aW9uO1xuICAgIHRoaXMucmVuZGVyU2FtcGxlc0xvY2F0aW9uO1xuXG4gICAgdGhpcy52ZXJ0ZXhCdWZmZXIgPSBudWxsO1xuICAgIHRoaXMuZnJhbWVCdWZmZXIgPSBudWxsO1xuICAgIHRoaXMuZmIgPSBudWxsO1xuICAgIHRoaXMudGV4dHVyZXMgPSBbXTtcbiAgICB0aGlzLnRyYWNlclByb2dyYW0gPSBudWxsO1xuICAgIHRoaXMucmVuZGVyVmVydGV4QXR0cmlidXRlID0gbnVsbDtcblxuICAgIHRoaXMudHJpYW5nbGVUZXh0dXJlID0gbnVsbDtcblxuICAgIHRoaXMubW91c2VQb3NpdGlvbiA9IHt4OiAwLCB5OiAwfTtcblxuICAgIHRoaXMuaW5pdCgpO1xuXG4gICAgdGhpcy5hbmltYXRlID0gKHRpbWUpID0+IHtcbiAgICAgIHRoaXMucmVzaXplQ2FudmFzKCk7XG4gICAgICBnbC52aWV3cG9ydCggMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCApO1xuXG4gICAgICAvLyByZW5kZXIgdG8gdGV4dHVyZVxuICAgICAgZ2wudXNlUHJvZ3JhbSh0aGlzLnRyYWNlclByb2dyYW0pO1xuXG4gICAgICB2YXIgbG9jYXRpb24xID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHRoaXMudHJhY2VyUHJvZ3JhbSwgXCJ1X2J1ZmZlcl90ZXh0dXJlXCIpO1xuICAgICAgdmFyIGxvY2F0aW9uMiA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbih0aGlzLnRyYWNlclByb2dyYW0sIFwidV90cmlhbmdsZV90ZXh0dXJlXCIpO1xuXG4gICAgICBnbC51bmlmb3JtMWkobG9jYXRpb24xLCAwKTtcbiAgICAgIGdsLnVuaWZvcm0xaShsb2NhdGlvbjIsIDEpO1xuXG4gICAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUwKTtcbiAgICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHRoaXMudGV4dHVyZXNbMF0pO1xuICAgICAgZ2wuYWN0aXZlVGV4dHVyZShnbC5URVhUVVJFMSk7XG4gICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCB0aGlzLnRyaWFuZ2xlVGV4dHVyZSk7XG5cbiAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCB0aGlzLnZlcnRleEJ1ZmZlcik7XG4gICAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIHRoaXMuZmIpO1xuICAgICAgZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoZ2wuRlJBTUVCVUZGRVIsIGdsLkNPTE9SX0FUVEFDSE1FTlQwLCBnbC5URVhUVVJFXzJELCB0aGlzLnRleHR1cmVzWzFdLCAwKTtcbiAgICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIodGhpcy50cmFjZXJWZXJ0ZXhBdHRyaWJ1dGUsIDIsIGdsLkZMT0FULCBmYWxzZSwgMCwgMCk7XG4gICAgICBnbC5kcmF3QXJyYXlzKGdsLlRSSUFOR0xFX1NUUklQLCAwLCA0KTtcbiAgICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgbnVsbCk7XG5cbiAgICAgIHRoaXMucGFyYW1ldGVycy50aW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aGlzLnBhcmFtZXRlcnMuc3RhcnRfdGltZTtcbiAgICAgIHRoaXMucGFyYW1ldGVycy5zYW1wbGVzICs9IDE7XG5cbiAgICAgIGdsLnVuaWZvcm0xZiggdGhpcy50aW1lTG9jYXRpb24sIHRoaXMucGFyYW1ldGVycy50aW1lIC8gMTAwMCk7XG4gICAgICBnbC51bmlmb3JtMWYoIHRoaXMuc2FtcGxlc0xvY2F0aW9uLCAgdGhpcy5wYXJhbWV0ZXJzLnNhbXBsZXMgKTtcbiAgICAgIGdsLnVuaWZvcm0yZiggdGhpcy5yZXNvbHV0aW9uTG9jYXRpb24sIHRoaXMucGFyYW1ldGVycy5zY3JlZW5XaWR0aCwgdGhpcy5wYXJhbWV0ZXJzLnNjcmVlbkhlaWdodCApO1xuICAgICAgZ2wudW5pZm9ybTJmKCB0aGlzLm1vdXNlUG9zaXRpb25Mb2NhdGlvbiwgdGhpcy5tb3VzZVBvc2l0aW9uLngsIHRoaXMubW91c2VQb3NpdGlvbi55ICk7XG5cbiAgICAgIHRoaXMudGV4dHVyZXMucmV2ZXJzZSgpO1xuXG4gICAgICBnbC51c2VQcm9ncmFtKHRoaXMucmVuZGVyUHJvZ3JhbSk7XG4gICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCB0aGlzLnRleHR1cmVzWzBdKTtcbiAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCB0aGlzLnZlcnRleEJ1ZmZlcik7XG4gICAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKHRoaXMucmVuZGVyVmVydGV4QXR0cmlidXRlLCAyLCBnbC5GTE9BVCwgZmFsc2UsIDAsIDApO1xuICAgICAgZ2wuZHJhd0FycmF5cyhnbC5UUklBTkdMRV9TVFJJUCwgMCwgNCk7XG4gICAgICBnbC51bmlmb3JtMWYoIHRoaXMucmVuZGVyU2FtcGxlc0xvY2F0aW9uLCAgdGhpcy5wYXJhbWV0ZXJzLnNhbXBsZXMgKTtcblxuXHRcdFx0cmVxdWVzdEFuaW1hdGlvbkZyYW1lKCB0aGlzLmFuaW1hdGUgKTtcbiAgICB9XG4gIH1cblxuICBjcmVhdGVSZW5kZXJQcm9ncmFtKCkge1xuICAgIGxldCB2ZXJ0aWNlcyA9IFstMSwgLTEsIC0xLCAxLCAxLCAtMSwgMSwgMV07XG4gICAgdGhpcy52ZXJ0ZXhCdWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTtcbiAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgdGhpcy52ZXJ0ZXhCdWZmZXIpO1xuICAgIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCBuZXcgRmxvYXQzMkFycmF5KHZlcnRpY2VzKSwgZ2wuU1RBVElDX0RSQVcpO1xuXG4gICAgLy90aGlzLmZyYW1lQnVmZmVyID0gZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTtcbiAgICB0aGlzLmZiID0gZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTtcblxuICAgIGxldCB0eXBlID0gZ2wuZ2V0RXh0ZW5zaW9uKCdPRVNfdGV4dHVyZV9mbG9hdCcpID8gZ2wuRkxPQVQgOiBnbC5VTlNJR05FRF9CWVRFO1xuICAgIHRoaXMudGV4dHVyZXMgPSBbXTtcbiAgICBmb3IodmFyIGkgPSAwOyBpIDwgMjsgaSsrKSB7XG4gICAgICB0aGlzLnRleHR1cmVzLnB1c2goZ2wuY3JlYXRlVGV4dHVyZSgpKTtcbiAgICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHRoaXMudGV4dHVyZXNbaV0pO1xuICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01BR19GSUxURVIsIGdsLk5FQVJFU1QpO1xuICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01JTl9GSUxURVIsIGdsLk5FQVJFU1QpO1xuICAgICAgZ2wudGV4SW1hZ2UyRChnbC5URVhUVVJFXzJELCAwLCBnbC5SR0IsIDUxMiwgNTEyLCAwLCBnbC5SR0IsIHR5cGUsIG51bGwpO1xuICAgIH1cbiAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBudWxsKTtcblxuICAgIC8vIGNyZWF0ZSByZW5kZXIgc2hhZGVyXG4gICAgbGV0IHJlbmRlcl92ZXJ0ZXhfc2hhZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZzX3JlbmRlcicpLnRleHRDb250ZW50O1xuICAgIGxldCByZW5kZXJfZnJhZ21lbnRfc2hhZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZzX3JlbmRlcicpLnRleHRDb250ZW50O1xuICAgIHRoaXMucmVuZGVyUHJvZ3JhbSA9IHRoaXMuY3JlYXRlUHJvZ3JhbShyZW5kZXJfdmVydGV4X3NoYWRlciwgcmVuZGVyX2ZyYWdtZW50X3NoYWRlcik7XG4gICAgdGhpcy5yZW5kZXJWZXJ0ZXhBdHRyaWJ1dGUgPSBnbC5nZXRBdHRyaWJMb2NhdGlvbih0aGlzLnJlbmRlclByb2dyYW0sICd2ZXJ0ZXgnKTtcbiAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheSh0aGlzLnJlbmRlclZlcnRleEF0dHJpYnV0ZSk7XG4gIH1cblxuICBhbGxvY2F0ZVRleHR1cmUoKSB7XG4gICAgICB0aGlzLnRyaWFuZ2xlVGV4dHVyZSA9IGdsLmNyZWF0ZVRleHR1cmUoKTtcbiAgICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHRoaXMudHJpYW5nbGVUZXh0dXJlKTtcbiAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NSU5fRklMVEVSLCBnbC5ORUFSRVNUKTtcbiAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBnbC5ORUFSRVNUKTtcbiAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9XUkFQX1MsIGdsLkNMQU1QX1RPX0VER0UpO1xuICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfVCwgZ2wuQ0xBTVBfVE9fRURHRSk7XG4gIH1cblxuICBhZGRTY2VuZVRleHR1cmVzKHRyaWFuZ2xlQXJyYXkpIHtcbiAgICB0aGlzLmFsbG9jYXRlVGV4dHVyZSgpO1xuICAgIGxldCB3aWR0aCA9IDEwMjQ7XG4gICAgbGV0IGhlaWdodCA9IDEwMjQ7XG4gICAgbGV0IGZvcm1hdCA9IGdsLlJHQjtcblxuICAgIGdsLnRleEltYWdlMkQoZ2wuVEVYVFVSRV8yRCwgMCwgZ2wuUkdCLCB3aWR0aCwgaGVpZ2h0LCAwLCBmb3JtYXQsIGdsLkZMT0FULCB0cmlhbmdsZUFycmF5KTtcbiAgfVxuXG4gIGluaXQoKSB7XG4gICAgY29uc29sZS5sb2coXCJpbml0IHJlbmRlcmVyXCIpO1xuICAgIExvYWRTaGFkZXJzKFtcbiAgICAgICcuL2Rpc3Qva2VybmVscy9oZWFkZXIuZ2xzbCcsXG4gICAgICAnLi9kaXN0L2tlcm5lbHMvY2VsbHVsYXIzRC5nbHNsJyxcbiAgICAgICcuL2Rpc3Qva2VybmVscy9ub2lzZTNELmdsc2wnLFxuICAgICAgJy4vZGlzdC9rZXJuZWxzL21haW4uZ2xzbCdcbiAgICBdLCAoa2VybmVsRGF0YSkgPT4ge1xuICAgICAgICB0aGlzLmZyYWdtZW50X3NoYWRlciA9IGtlcm5lbERhdGE7XG4gICAgICAgIHRoaXMudmVydGV4X3NoYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2cycpLnRleHRDb250ZW50O1xuICAgIFx0XHR0aGlzLmNhbnZhcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2NhbnZhcycpO1xuXG4gICAgXHRcdC8vIEluaXRpYWxpc2UgV2ViR0xcbiAgICBcdFx0dHJ5IHsgZ2wgPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCAnZXhwZXJpbWVudGFsLXdlYmdsJyApOyB9IGNhdGNoKCBlcnJvciApIHsgfVxuICAgIFx0XHRpZiAoICFnbCApIHRocm93IFwiY2Fubm90IGNyZWF0ZSB3ZWJnbCBjb250ZXh0XCI7XG5cbiAgICAgICAgdGhpcy5jcmVhdGVSZW5kZXJQcm9ncmFtKCk7XG5cbiAgICBcdFx0Ly8gQ3JlYXRlIFZlcnRleCBidWZmZXIgKDIgdHJpYW5nbGVzKVxuICAgIFx0XHR0aGlzLmJ1ZmZlciA9IGdsLmNyZWF0ZUJ1ZmZlcigpO1xuICAgIFx0XHRnbC5iaW5kQnVmZmVyKCBnbC5BUlJBWV9CVUZGRVIsIHRoaXMuYnVmZmVyICk7XG4gICAgXHRcdGdsLmJ1ZmZlckRhdGEoIGdsLkFSUkFZX0JVRkZFUiwgbmV3IEZsb2F0MzJBcnJheSggWyAtMS4wLCAtMS4wLCAtMS4wLCAxLjAsIDEuMCwgLTEuMCwgMS4wLCAtIDEuMCwgMS4wLCAxLjAsIC0gMS4wLCAxLjAgXSApLCBnbC5TVEFUSUNfRFJBVyApO1xuXG4gICAgXHRcdC8vIENyZWF0ZSBQcm9ncmFtXG4gICAgXHRcdHRoaXMudHJhY2VyUHJvZ3JhbSA9IHRoaXMuY3JlYXRlUHJvZ3JhbSggdGhpcy52ZXJ0ZXhfc2hhZGVyLCB0aGlzLmZyYWdtZW50X3NoYWRlciApO1xuICAgICAgICB0aGlzLnRyYWNlclZlcnRleEF0dHJpYnV0ZSA9IGdsLmdldEF0dHJpYkxvY2F0aW9uKHRoaXMudHJhY2VyUHJvZ3JhbSwgJ3ZlcnRleCcpO1xuICAgICAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheSh0aGlzLnRyYWNlclZlcnRleEF0dHJpYnV0ZSk7XG5cbiAgICAgICAgdGhpcy50aW1lTG9jYXRpb24gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24oIHRoaXMudHJhY2VyUHJvZ3JhbSwgJ3RpbWUnICk7XG4gICAgICAgIHRoaXMuc2FtcGxlc0xvY2F0aW9uID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKCB0aGlzLnRyYWNlclByb2dyYW0sICdzYW1wbGVzJyApO1xuICAgIFx0XHR0aGlzLnJlc29sdXRpb25Mb2NhdGlvbiA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbiggdGhpcy50cmFjZXJQcm9ncmFtLCAncmVzb2x1dGlvbicgKTtcbiAgICBcdFx0dGhpcy5tb3VzZVBvc2l0aW9uTG9jYXRpb24gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24oIHRoaXMudHJhY2VyUHJvZ3JhbSwgJ21vdXNlUG9zaXRpb24nICk7XG4gICAgICAgIHRoaXMucmVuZGVyU2FtcGxlc0xvY2F0aW9uID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKCB0aGlzLnJlbmRlclByb2dyYW0sICdzYW1wbGVzJyApO1xuXG4gICAgICAgIHRoaXMuYW5pbWF0ZSgpO1xuICAgIH0sXG4gICAgKCkgPT4ge30pO1xuXG4gICAgJCggXCIjcmVuZGVyLWNhbnZhc1wiICkubW91c2Vtb3ZlKChldmVudCkgPT4ge1xuICAgICAgdGhpcy5tb3VzZVBvc2l0aW9uLnggPSBldmVudC5wYWdlWDtcbiAgICAgIHRoaXMubW91c2VQb3NpdGlvbi55ID0gZXZlbnQucGFnZVk7XG4gICAgfSk7XG5cbiAgfVxuXG4gIGNyZWF0ZVByb2dyYW0odmVydGV4LCBmcmFnbWVudCkge1xuICAgIGxldCBwcm9ncmFtID0gZ2wuY3JlYXRlUHJvZ3JhbSgpO1xuXG5cdFx0bGV0IHZzID0gdGhpcy5jcmVhdGVTaGFkZXIoIHZlcnRleCwgZ2wuVkVSVEVYX1NIQURFUiApO1xuXHRcdGxldCBmcyA9IHRoaXMuY3JlYXRlU2hhZGVyKCBmcmFnbWVudCwgZ2wuRlJBR01FTlRfU0hBREVSICk7XG5cblx0XHRnbC5hdHRhY2hTaGFkZXIoIHByb2dyYW0sIHZzICk7XG5cdFx0Z2wuYXR0YWNoU2hhZGVyKCBwcm9ncmFtLCBmcyApO1xuXG5cdFx0Z2wuZGVsZXRlU2hhZGVyKCB2cyApO1xuXHRcdGdsLmRlbGV0ZVNoYWRlciggZnMgKTtcblxuXHRcdGdsLmxpbmtQcm9ncmFtKCBwcm9ncmFtICk7XG5cbiAgICB2YXIgbG9nID0gZ2wuZ2V0UHJvZ3JhbUluZm9Mb2cocHJvZ3JhbSk7XG4gICAgaWYgKGxvZykge1xuICAgICAgY29uc29sZS5sb2cobG9nKTtcbiAgICB9XG5cbiAgICBsb2cgPSBnbC5nZXRTaGFkZXJJbmZvTG9nKHZzKTtcbiAgICBpZiAobG9nKSB7XG4gICAgICBjb25zb2xlLmxvZyhsb2cpO1xuICAgIH1cblxuICAgIGxvZyA9IGdsLmdldFNoYWRlckluZm9Mb2coZnMpO1xuICAgIGlmIChsb2cpIHtcbiAgICAgIGNvbnNvbGUubG9nKGxvZyk7XG4gICAgfVxuXG5cdFx0aWYgKCAhZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlciggcHJvZ3JhbSwgZ2wuTElOS19TVEFUVVMgKSApIHtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHJldHVybiBwcm9ncmFtO1xuICB9XG5cbiAgY3JlYXRlU2hhZGVyKHNyYywgdHlwZSkge1xuICAgIGxldCBzaGFkZXIgPSBnbC5jcmVhdGVTaGFkZXIoIHR5cGUgKTtcblxuXHRcdGdsLnNoYWRlclNvdXJjZSggc2hhZGVyLCBzcmMgKTtcblx0XHRnbC5jb21waWxlU2hhZGVyKCBzaGFkZXIgKTtcblxuXHRcdGlmICghZ2wuZ2V0U2hhZGVyUGFyYW1ldGVyKCBzaGFkZXIsIGdsLkNPTVBJTEVfU1RBVFVTKSkge1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHRcdHJldHVybiBzaGFkZXI7XG4gIH1cblxuICByZXNpemVDYW52YXMoZXZlbnQpIHtcbiAgICBpZih0aGlzLmNhbnZhcy53aWR0aCAhPSB0aGlzLmNhbnZhcy5jbGllbnRXaWR0aCB8fCB0aGlzLmNhbnZhcy5oZWlnaHQgIT0gdGhpcy5jYW52YXMuY2xpZW50SGVpZ2h0KSB7XG5cdFx0XHR0aGlzLmNhbnZhcy53aWR0aCA9IHRoaXMuY2FudmFzLmNsaWVudFdpZHRoO1xuXHRcdFx0dGhpcy5jYW52YXMuaGVpZ2h0ID0gdGhpcy5jYW52YXMuY2xpZW50SGVpZ2h0O1xuXG5cdFx0XHR0aGlzLnBhcmFtZXRlcnMuc2NyZWVuV2lkdGggPSB0aGlzLmNhbnZhcy53aWR0aDtcblx0XHRcdHRoaXMucGFyYW1ldGVycy5zY3JlZW5IZWlnaHQgPSB0aGlzLmNhbnZhcy5oZWlnaHQ7XG5cblx0XHRcdGdsLnZpZXdwb3J0KCAwLCAwLCB0aGlzLmNhbnZhcy53aWR0aCwgdGhpcy5jYW52YXMuaGVpZ2h0ICk7XG5cdFx0fVxuICB9XG5cbn1cbiIsImZ1bmN0aW9uIExvYWRTaGFkZXIoZmlsZU5hbWUsIGluZGV4LCBjYWxsYmFjaykge1xuICBqUXVlcnkuZ2V0KGZpbGVOYW1lLCAoZGF0YSkgPT4ge1xuICAgIGNhbGxiYWNrKGRhdGEsIGluZGV4KTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBMb2FkU2hhZGVycyhmaWxlTmFtZXMsIGNhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7XG4gIGxldCBsb2FkZWRfZmlsZXMgPSAwO1xuICBsZXQgc2hhZGVyX2ZpbGVzID0gW107XG4gIGZvciAobGV0IGZpbGVfaW5kZXggPSAwOyBmaWxlX2luZGV4IDwgZmlsZU5hbWVzLmxlbmd0aDsgZmlsZV9pbmRleCsrKSB7XG4gICAgICBMb2FkU2hhZGVyKGZpbGVOYW1lc1tmaWxlX2luZGV4XSwgZmlsZV9pbmRleCwgKGRhdGEsIHNoYWRlcl9pbmRleCkgPT4ge1xuICAgICAgICBzaGFkZXJfZmlsZXNbc2hhZGVyX2luZGV4XSA9IGRhdGE7XG5cbiAgICAgICAgbG9hZGVkX2ZpbGVzKys7XG4gICAgICAgIGlmIChsb2FkZWRfZmlsZXMgPT0gZmlsZU5hbWVzLmxlbmd0aCkge1xuICAgICAgICAgIGxldCB0b3RhbF9zaGFkZXJfZGF0YSA9ICcnO1xuICAgICAgICAgIGZvciAobGV0IHNoYWRlcl9kYXRhIG9mIHNoYWRlcl9maWxlcykge1xuICAgICAgICAgICAgdG90YWxfc2hhZGVyX2RhdGEgKz0gc2hhZGVyX2RhdGE7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhbGxiYWNrKHRvdGFsX3NoYWRlcl9kYXRhKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgfVxufVxuIl19
